<html>
	<head>
		<title>Github Language Distribution On Earth</title>
		<link rel="stylesheet" type="text/css" href="./css/dist.css">
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script type="text/javascript" src="./js/dist.js"></script>
		<script>
			// TAOTODO: Render the map here

			var map = null;

			function initMap() {
				map = new google.maps.Map(document.getElementById('map'), {
					zoom: 13,
					center: {lat: 37.775, lng: -122.434},
					mapTypeId: google.maps.MapTypeId.SATELLITE
				});

				// TAOTODO: Draw heat map separately 
				// for each individual language
				var heatmap = new google.maps.visualization.HeatmapLayer({
					data: getDistByLang('Ruby'),
					map: map
				});
			}

			function toggleHeatmap(heatmap) {
				heatmap.setMap(heatmap.getMap() ? null : map);
			}

			function gradient(heatmap){
				var _gradients = [
					'rgba(0, 255, 255, 0)',
					'rgba(0, 255, 255, 1)',
					'rgba(0, 191, 255, 1)',
					'rgba(0, 127, 255, 1)',
					'rgba(0, 63, 255, 1)',
					'rgba(0, 0, 255, 1)',
					'rgba(0, 0, 223, 1)',
					'rgba(0, 0, 191, 1)',
					'rgba(0, 0, 159, 1)',
					'rgba(0, 0, 127, 1)',
					'rgba(63, 0, 91, 1)',
					'rgba(127, 0, 63, 1)',
					'rgba(191, 0, 31, 1)',
					'rgba(255, 0, 0, 1)'
				]
				heatmap.set('gradient',heatmap.get('gradient') ? null : _gradients)
			}

			function makeGoogleCoord(coord){
				// TAOTODO: Generate cloud point based on density
				var density = coord[2];
				return new google.maps.LatLng(coord[0],coord[1])
			}

			function getDistByLang(lang){
				// TAOTODO: Load the distribution records from JSON
				var allDist = getDist();
				var dist = allDist.filter((n) => n._id==lang);
				if (dist.length==0){
					console.error('Unknown language : ',lang);
					return false;
				}

				return dist.coords.map(makeGoogleCoord);
			}

		// Add deferred loaded script
		var script = document.createElement('script');
		var url = "https://maps.googleapis.com/maps/api/js?key=getApiKey()&libraries=visualization&callback=initMap"; // TAOTODO: Load and place google API key in the URL
		script.setAttribute('src',url);
		script.setAttribute('async');
		script.setAttribute('defer');
		document.body.appendChild(script);
		</script>
	</head>
	<body>
		<div id="map"></div>
	</body>
</script>
